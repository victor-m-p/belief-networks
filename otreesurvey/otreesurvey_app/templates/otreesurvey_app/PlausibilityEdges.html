{% extends "global/Page.html" %}

{% block styles %}
<style>
    .influence-button {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        color: white;
        font-weight: bold;
        font-size: 16px;
        border-radius: 8px;
        cursor: pointer;
    }
    .positive { background-color: green; }
    .negative { background-color: red; }
    .none { background-color: grey; }
    .selected { border: 3px solid black; }
</style>
{% endblock %}

{% block content %}
<h2>Evaluate Influence Between Pairs of Statements</h2>

<p>Please indicate whether one statement influences the other. If there is an influence, also rate how strong it is.</p>

{% for pair_num, pair in all_pairs %}
<div style="margin-bottom: 30px;">
    <div style="display: flex; justify-content: center; margin-bottom: 10px;">
        <div style="width: 200px; text-align: center;">{{ pair.0 }}</div>
        <div style="width: 200px; text-align: center;">{{ pair.1 }}</div>
    </div>

    <div style="text-align: center;">
        <button type="button" class="influence-button positive" data-pair="{{ pair_num }}" data-value="1">Positive</button>
        <button type="button" class="influence-button negative" data-pair="{{ pair_num }}" data-value="2">Negative</button>
        <button type="button" class="influence-button none" data-pair="{{ pair_num }}" data-value="0">No Influence</button>
    </div>

    <div id="strength_section_{{ pair_num }}" style="display:none; margin-top:10px; text-align: center;">
        <p>Influence strength (1-100):</p>
        <input type="range" id="strength_slider_{{ pair_num }}" min="1" max="100" style="width:300px;" data-touched="false">
        <span id="strength_value_{{ pair_num }}">â€”</span>
    </div>

    <input type="hidden" name="plausibility_edge_{{ pair_num }}_type" id="type_input_{{ pair_num }}">
    <input type="hidden" name="plausibility_edge_{{ pair_num }}_strength" id="strength_input_{{ pair_num }}">
</div>
{% endfor %}

{{ next_button }}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", function() {

    function handleSelection(pair, value) {
        document.getElementById(`type_input_${pair}`).value = value;

        document.querySelectorAll(`[data-pair="${pair}"]`).forEach(btn => {
            btn.classList.remove("selected");
        });
        document.querySelector(`[data-pair="${pair}"][data-value="${value}"]`).classList.add("selected");

        if (value === "1" || value === "2") {
            document.getElementById(`strength_section_${pair}`).style.display = "block";
            document.getElementById(`strength_input_${pair}`).value = "";
        } else {
            document.getElementById(`strength_section_${pair}`).style.display = "none";
            document.getElementById(`strength_input_${pair}`).value = "";
        }
    }

    document.querySelectorAll(".influence-button").forEach(btn => {
        btn.addEventListener("click", function() {
            const pair = this.dataset.pair;
            const value = this.dataset.value;
            handleSelection(pair, value);
        });
    });

    [1, 2, 3].forEach(pair => {
        const slider = document.getElementById(`strength_slider_${pair}`);
        const output = document.getElementById(`strength_value_${pair}`);

        slider.addEventListener("input", () => {
            slider.dataset.touched = "true";
            output.textContent = slider.value;
            document.getElementById(`strength_input_${pair}`).value = slider.value;
        });
    });

    document.querySelector("button[type=submit], .otree-btn-next").addEventListener("click", function(e) {
        let valid = true;
        [1, 2, 3].forEach(pair => {
            const typeVal = document.getElementById(`type_input_${pair}`).value;
            if (typeVal === "") {
                valid = false;
            } else if (typeVal === "1" || typeVal === "2") {
                const touched = document.getElementById(`strength_slider_${pair}`).dataset.touched === "true";
                if (!touched) {
                    valid = false;
                }
            }
        });

        if (!valid) {
            e.preventDefault();
            alert("Please complete all inputs before continuing.");
        }
    });
});
</script>
{% endblock %}
