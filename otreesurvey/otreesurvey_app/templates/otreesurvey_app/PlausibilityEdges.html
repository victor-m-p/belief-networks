{% extends "global/Page.html" %}

{% block styles %}
<style>
    .influence-button {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        color: white;
        font-weight: bold;
        font-size: 16px;
        border-radius: 8px;
        cursor: pointer;
    }
    .positive { background-color: green; }
    .negative { background-color: red; }
    .none { background-color: grey; }
    .selected { border: 3px solid black; }

    .influence-text {
    font-weight: bold;
    padding: 2px 6px;
    border-radius: 4px;
    }

    .influence-positive {
        background-color: green;
        color: white;
    }

    .influence-negative {
        background-color: red;
        color: white;
    }

    .influence-none {
        background-color: grey;
        color: white;
    }

    .influence-unset {
        color: #444;
        font-style: italic;
    }

    .influence-text {
    font-weight: bold;
    transition: font-size 0.2s ease;
    }
</style>
{% endblock %}

{% block content %}
<h2>Which things influence each other?</h2>
<p>Your task is to judge which things influence eachc other and how</p>

{% for pair_num, pair in all_pairs %}
<div style="margin-bottom: 30px;">
    <div style="margin-bottom: 10px; text-align: center;">
        <p style="font-size: 18px;">
            There is 
            <span id="influence_label_{{ pair_num }}" class="influence-text">[select one]</span>
            influence between 
            <span style="font-weight: bold;">{{ pair.0 }}</span> 
            and 
            <span style="font-weight: bold;">{{ pair.1 }}</span>.
        </p>
    </div>

    <div style="text-align: center;">
        <button type="button" class="influence-button positive" data-pair="{{ pair_num }}" data-value="1">Positive</button>
        <button type="button" class="influence-button negative" data-pair="{{ pair_num }}" data-value="2">Negative</button>
        <button type="button" class="influence-button none" data-pair="{{ pair_num }}" data-value="0">No Influence</button>
    </div>

    <div id="strength_section_{{ pair_num }}" style="display:none; margin-top:10px; text-align: center;">
        <p>Strength of influence (1-100)</p>
        <input type="range" id="strength_slider_{{ pair_num }}" min="1" max="100" style="width:300px;" data-touched="false">
        <span id="strength_value_{{ pair_num }}"></span>
    </div>

    <input type="hidden" name="plausibility_edge_{{ pair_num }}_type" id="type_input_{{ pair_num }}">
    <input type="hidden" name="plausibility_edge_{{ pair_num }}_strength" id="strength_input_{{ pair_num }}">
</div>
{% endfor %}

{{ next_button }}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", function() {

    function handleSelection(pair, value) {
        document.getElementById(`type_input_${pair}`).value = value;

        // ðŸ”½ Set label text and color
        const label = document.getElementById(`influence_label_${pair}`);
        label.className = "influence-text"; // Reset first

        if (value === "1") {
            label.textContent = "POSITIVE";
            label.classList.add("influence-positive");
        } else if (value === "2") {
            label.textContent = "NEGATIVE";
            label.classList.add("influence-negative");
        } else {
            label.textContent = "NO";
            label.classList.add("influence-none");
        }

        // ðŸ”½ Update selected button
        document.querySelectorAll(`[data-pair="${pair}"]`).forEach(btn => {
            btn.classList.remove("selected");
        });
        document.querySelector(`[data-pair="${pair}"][data-value="${value}"]`).classList.add("selected");

        // ðŸ”½ Show/hide slider
        if (value === "1" || value === "2") {
            document.getElementById(`strength_section_${pair}`).style.display = "block";
            document.getElementById(`strength_input_${pair}`).value = "";
        } else {
            document.getElementById(`strength_section_${pair}`).style.display = "none";
            document.getElementById(`strength_input_${pair}`).value = "";
        }
    }

    document.querySelectorAll(".influence-button").forEach(btn => {
        btn.addEventListener("click", function() {
            const pair = this.dataset.pair;
            const value = this.dataset.value;
            handleSelection(pair, value);
        });
    });

    [1, 2, 3].forEach(pair => {
        const slider = document.getElementById(`strength_slider_${pair}`);
        const output = document.getElementById(`strength_value_${pair}`);

    slider.addEventListener("input", () => {
        slider.dataset.touched = "true";
        output.textContent = slider.value;
        document.getElementById(`strength_input_${pair}`).value = slider.value;

        // ðŸ”½ Dynamic scaling of label font size
        const label = document.getElementById(`influence_label_${pair}`);
        const minFontSize = 10;
        const maxFontSize = 24;
        const fontSize = minFontSize + ((slider.value - 1) / 99) * (maxFontSize - minFontSize);
        label.style.fontSize = `${fontSize}px`;
    });

    });

    document.querySelector("button[type=submit], .otree-btn-next").addEventListener("click", function(e) {
        let valid = true;
        [1, 2, 3].forEach(pair => {
            const typeVal = document.getElementById(`type_input_${pair}`).value;
            if (typeVal === "") {
                valid = false;
            } else if (typeVal === "1" || typeVal === "2") {
                const touched = document.getElementById(`strength_slider_${pair}`).dataset.touched === "true";
                if (!touched) {
                    valid = false;
                }
            }
        });

        if (!valid) {
            e.preventDefault();
            alert("Please complete all inputs before continuing.");
        }
    });
});
</script>
{% endblock %}
